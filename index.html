<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QR â†’ GLB Overlay (Web, transparent fix)</title>

  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@zxing/library@0.20.0/umd/index.min.js"></script>

  <style>
    html, body { margin:0; padding:0; overflow:hidden; background:#000; font-family:-apple-system,system-ui,sans-serif; }

    #start { position:fixed; inset:0; display:grid; place-items:center; background:rgba(0,0,0,.85); color:#fff; z-index:10; }
    #btn { padding:14px 18px; border-radius:12px; border:1px solid rgba(255,255,255,.35); background:rgba(255,255,255,.12); }

    #hud {
      position:fixed; top:10px; left:10px; padding:8px 10px;
      background:rgba(0,0,0,.65); color:#fff; font-size:13px;
      border-radius:6px; white-space:pre-line; z-index:20;
      user-select:none; -webkit-user-select:none; max-width:calc(100vw - 20px);
    }

    #video {
      position:fixed; inset:0; width:100vw; height:100vh;
      object-fit:cover; background:#000; z-index:0;
    }

    /* A-Frame overlay */
    #aframeWrap { position:fixed; inset:0; z-index:1; pointer-events:none; }
    #aframeWrap canvas { background: transparent !important; }
    a-scene { background: transparent !important; }
  </style>
</head>

<body>
  <div id="start"><div id="btn">Start Kamera</div></div>
  <div id="hud">WAITING FOR TAP</div>

  <video id="video" playsinline webkit-playsinline muted></video>

  <div id="aframeWrap"></div>

  <script>
    const hud = document.getElementById("hud");
    const start = document.getElementById("start");
    const btn = document.getElementById("btn");
    const video = document.getElementById("video");
    const wrap = document.getElementById("aframeWrap");

    const reader = new ZXing.BrowserMultiFormatReader();

    let sceneEl = null;
    let modelEnt = null;
    let camEl = null;

    let lastFoundAt = 0;
    let lastText = "";

    // simple smoothing
    let smooth = { x:0, y:0, z:-2, s:1, yaw:0 };
    const lerp = (a,b,t) => a + (b-a)*t;

    function setHUD(lines){ hud.textContent = lines.join("\n"); }

    async function startCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({
          audio:false,
          video:{
            facingMode:{ ideal:"environment" },
            width:{ ideal:1280 },
            height:{ ideal:720 }
          }
        });
        video.srcObject = stream;
        video.muted = true;
        video.setAttribute("playsinline","");
        video.setAttribute("webkit-playsinline","");
        await video.play();
      } catch (e) {
        setHUD(["CAMERA: ERROR", String(e && e.message ? e.message : e)]);
        throw e;
      }
    }

    function waitVideoDims() {
      return new Promise(res => {
        const t = setInterval(() => {
          if (video.videoWidth && video.videoHeight) { clearInterval(t); res(); }
        }, 50);
      });
    }

    function mountAFrame() {
      // Build scene only once
      if (sceneEl) return;

      wrap.innerHTML = `
        <a-scene
          embedded
          vr-mode-ui="enabled:false"
          renderer="alpha:true; antialias:true; colorManagement:true"
          background="transparent:true"
        >
          <a-assets>
            <a-asset-item id="model" src="/QR-CODE/enno6_test.glb?v=1"></a-asset-item>
          </a-assets>

          <a-entity light="type: ambient; intensity: 1.2"></a-entity>
          <a-entity light="type: directional; intensity: 1" position="1 2 1"></a-entity>

          <a-entity
            id="modelEnt"
            gltf-model="#model"
            visible="false"
            position="0 0 -2"
            rotation="0 0 0"
            scale="1 1 1"
          ></a-entity>

          <a-entity id="cam" camera position="0 0 0"></a-entity>
        </a-scene>
      `;

      sceneEl = wrap.querySelector("a-scene");
      modelEnt = sceneEl.querySelector("#modelEnt");
      camEl = sceneEl.querySelector("#cam");
