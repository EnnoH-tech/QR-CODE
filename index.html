<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>BarcodeDetector Test</title>
  <style>
    body { margin:0; background:#000; color:#fff; font-family:-apple-system,system-ui; }
    #hud { position:fixed; top:10px; left:10px; background:rgba(0,0,0,.6); padding:8px; z-index:2; }
    video { width:100vw; height:100vh; object-fit:cover; }
  </style>
</head>
<body>

<div id="hud">starting…</div>
<video id="video" playsinline webkit-playsinline muted></video>

<script>
const hud = document.getElementById("hud");
const video = document.getElementById("video");

if (!("BarcodeDetector" in window)) {
  hud.textContent = "BarcodeDetector NOT supported";
  throw new Error("BarcodeDetector not supported");
}

const detector = new BarcodeDetector({ formats: ["qr_code"] });

async function start() {
  const stream = await navigator.mediaDevices.getUserMedia({
    video: { facingMode: { ideal: "environment" } },
    audio: false
  });
  video.srcObject = stream;
  await video.play();
  hud.textContent = "CAMERA OK – scanning…";
  scan();
}

async function scan() {
  if (video.readyState >= 2) {
    try {
      const barcodes = await detector.detect(video);
      if (barcodes.length) {
        hud.textContent = "QR FOUND:\n" + barcodes[0].rawValue;
        return; // stop on success
      }
    } catch (e) {
      hud.textContent = "DETECT ERROR";
    }
  }
  requestAnimationFrame(scan);
}

start();
</script>
</body>
</html>
